<section class="content container-fluid">
    <mat-card>
        <mat-card-content class="top-card">
          <button mat-raised-button>Reports</button>
          <button mat-raised-button *ngIf="role !== 'WOREDA_COORDINATOR' && role !== 'MAYER' && role.substring(0,5)!=='ZONE_'" [routerLink]="['/dash/report']">New </button>
        </mat-card-content>
      </mat-card>
      
      <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
        <div class="reports" *ngIf="role.substring(0,5)!=='ZONE_'&&role.substring(0,7)!=='WOREDA_'&&role!=='MAYER'">
        <mat-tab label="Reports">
          <mat-card>
            <mat-form-field>
                <mat-label>Filter</mat-label>
                <input matInput (keyup)="applyFilter($event)" placeholder="Ex. Mia" #input>
            </mat-form-field>
          </mat-card>
        
        <div class="mat-elevation-z8">
            <mat-table [dataSource]="dataSource" matSort>
        
                <ng-container matColumnDef="id">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> ID </mat-header-cell>
                    <mat-cell style="cursor: pointer;" *matCellDef="let element;let i=index" data-bs-toggle="modal" data-bs-target="#detailModal" (click)="viewDetail(element.id)">{{i+1}} </mat-cell>
                </ng-container>
        
                <ng-container matColumnDef="name">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Name </mat-header-cell>
                    <mat-cell *matCellDef="let element" > {{element.name}} </mat-cell>
                </ng-container>
                <ng-container matColumnDef="status">
                  <mat-header-cell *matHeaderCellDef mat-sort-header> Status </mat-header-cell>
                  <mat-cell *matCellDef="let element" > {{element.status}} </mat-cell>
              </ng-container>
                <ng-container matColumnDef="attachment">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Attachment </mat-header-cell>
                    <mat-cell *matCellDef="let element"><a href="assets/reports/{{element.attachment}}" download target="_blank">{{element.attachment}}</a> </mat-cell>
                </ng-container>
              <ng-container matColumnDef="lastModified">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Last Modified </mat-header-cell>
                <mat-cell *matCellDef="let element"> {{element.lastModified }} </mat-cell>
            </ng-container>
              <ng-container matColumnDef="dateAdded">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Date Added</mat-header-cell>
                <mat-cell *matCellDef="let element"> {{element.dateAdded}} </mat-cell>
            </ng-container>
            <ng-container matColumnDef="acceptanceStatus">
              <mat-header-cell *matHeaderCellDef mat-sort-header>Zone Acceptance</mat-header-cell>
              <mat-cell *matCellDef="let element"> {{element.acceptanceStatus}} </mat-cell>
          </ng-container>
                <ng-container matColumnDef="actions">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Action </mat-header-cell>
                    <mat-cell *matCellDef="let element" >
                        <button mat-button *ngIf="false" color="accent" data-bs-toggle="modal" data-bs-target="#exampleModal" (click)="setId(element.id)"><mat-icon>delete</mat-icon></button>|
                        <button *ngIf="false" (click)="setEditId(element.id)" mat-button
                            color="primary"><mat-icon  >edit</mat-icon></button> </mat-cell>
                </ng-container>
                <mat-header-row *matHeaderRowDef="displayedColumnAll"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedColumnAll;"></mat-row>
            </mat-table>
            <mat-paginator *ngIf="dataSource" [pageSize]="15" #paginatorAll="matPaginator"  [length]="dataSource.data.length" [pageSizeOptions]="[15, 50, 100]" aria-label="Select page" showFirstLastButtons>
            </mat-paginator>
        </div>
      </mat-tab>
    </div>
      <div class="draft" *ngIf="draft">
      <mat-tab label="Draft" *ngIf="dataSourceDraft">
        <mat-card>
          <mat-form-field>
              <mat-label>Filter</mat-label>
              <input matInput (keyup)="applyFilterDraft($event)" placeholder="Ex. Mia" #input>
          </mat-form-field>
        </mat-card>
        <div class="mat-elevation-z8" *ngIf="dataSourceDraft">
        <mat-table [dataSource]="dataSourceDraft"  matSort >
    
            <ng-container matColumnDef="id">
                <mat-header-cell *matHeaderCellDef mat-sort-header> ID </mat-header-cell>
                <mat-cell style="cursor: pointer;" *matCellDef="let element;let i=index" data-bs-toggle="modal" data-bs-target="#detailModal" (click)="viewDetail(element.id)">{{i+1}} </mat-cell>
            </ng-container>
    
            <ng-container matColumnDef="name">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Name </mat-header-cell>
                <mat-cell *matCellDef="let element" > {{element.name}} </mat-cell>
            </ng-container>
            <ng-container matColumnDef="status">
              <mat-header-cell *matHeaderCellDef mat-sort-header> Status </mat-header-cell>
              <mat-cell *matCellDef="let element" > {{element.status}} </mat-cell>
          </ng-container>
            
            <ng-container matColumnDef="attachment">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Attachment </mat-header-cell>
                <mat-cell *matCellDef="let element"><a href="assets/reports/{{element.attachment}}" download target="_blank">{{element.attachment}}</a> </mat-cell>
            </ng-container>
            <ng-container matColumnDef="remark">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Description </mat-header-cell>
                <mat-cell *matCellDef="let element"> {{element.remark}} </mat-cell>
            </ng-container>
            <ng-container matColumnDef="fRemark">
              <mat-header-cell *matHeaderCellDef mat-sort-header> Remark </mat-header-cell>
              <mat-cell *matCellDef="let element"> {{element.fRemark }} </mat-cell>
          </ng-container>
          <ng-container matColumnDef="lastModified">
            <mat-header-cell *matHeaderCellDef mat-sort-header> Last Modified </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.lastModified }} </mat-cell>
        </ng-container>
          <ng-container matColumnDef="dateAdded">
            <mat-header-cell *matHeaderCellDef mat-sort-header> Date Added</mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.dateAdded}} </mat-cell>
        </ng-container>
        <ng-container matColumnDef="acceptanceStatus">
          <mat-header-cell *matHeaderCellDef mat-sort-header>Zone Acceptance</mat-header-cell>
          <mat-cell *matCellDef="let element"> {{element.acceptanceStatus}} </mat-cell>
      </ng-container>
            <ng-container matColumnDef="actions">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Action </mat-header-cell>
                <mat-cell *matCellDef="let element">
                    <button mat-button color="accent" data-bs-toggle="modal" data-bs-target="#exampleModal" (click)="setId(element.id)"><mat-icon>delete</mat-icon></button>|
                    <button (click)="setEditId(element.id)" mat-button
                        color="primary"><mat-icon  >edit</mat-icon></button> </mat-cell>
            </ng-container>
            <mat-header-row *matHeaderRowDef="displayedColumnsDraft"></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedColumnsDraft;"></mat-row>
        </mat-table>
        <mat-paginator *ngIf="dataSourceDraft" [pageSize]="15" #paginatorD="matPaginator"  [length]="dataSourceDraft.data.length" [pageSizeOptions]="[15, 50, 100]" aria-label="Select page" showFirstLastButtons>
        </mat-paginator>
    </div>
  </mat-tab>
</div>
  <ng-container matColumnDef="acceptanceStatus">
              <mat-header-cell *matHeaderCellDef mat-sort-header>Zone Acceptance</mat-header-cell>
              <mat-cell *matCellDef="let element"> {{element.acceptanceStatus}} </mat-cell>
          </ng-container><div class="reviewed" *ngIf="reviewed">
        <mat-tab label="Reviewed" (change)="getReviewedReports()">
          <mat-card>
            <mat-form-field>
                <mat-label>Filter</mat-label>
                <input matInput (keyup)="applyFilterReviewed($event)" placeholder="Ex. Mia" #input>
            </mat-form-field>
          </mat-card>
          <div class="mat-elevation-z8">
          <mat-table [dataSource]="dataSourceReviewed" matSort>
      
              <ng-container matColumnDef="id">
                  <mat-header-cell *matHeaderCellDef mat-sort-header> ID </mat-header-cell>
                  <mat-cell style="cursor: pointer;" *matCellDef="let element;let i=index" data-bs-toggle="modal" data-bs-target="#detailModal" (click)="viewDetail(element.id)">{{i+1}} </mat-cell>
              </ng-container>
      
              <ng-container matColumnDef="name">
                  <mat-header-cell *matHeaderCellDef mat-sort-header> Name </mat-header-cell>
                  <mat-cell *matCellDef="let element" > {{element.name}} </mat-cell>
              </ng-container>
              <ng-container matColumnDef="status">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Status </mat-header-cell>
                <mat-cell *matCellDef="let element" > {{element.status}} </mat-cell>
            </ng-container>
              
              <ng-container matColumnDef="attachment">
                  <mat-header-cell *matHeaderCellDef mat-sort-header> Attachment </mat-header-cell>
                  <mat-cell *matCellDef="let element"><a href="assets/reports/{{element.attachment}}" download target="_blank">{{element.attachment}}</a> </mat-cell>
              </ng-container>
              <ng-container matColumnDef="remark">
                  <mat-header-cell *matHeaderCellDef mat-sort-header> Description </mat-header-cell>
                  <mat-cell *matCellDef="let element"> {{element.remark}} </mat-cell>
              </ng-container>
              <ng-container matColumnDef="fRemark">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Remark </mat-header-cell>
                <mat-cell *matCellDef="let element"> {{element.fRemark }} </mat-cell>
            </ng-container>
            <ng-container matColumnDef="lastModified">
              <mat-header-cell *matHeaderCellDef mat-sort-header> Last Modified </mat-header-cell>
              <mat-cell *matCellDef="let element"> {{element.lastModified }} </mat-cell>
          </ng-container>
            <ng-container matColumnDef="dateAdded">
              <mat-header-cell *matHeaderCellDef mat-sort-header> Date Added</mat-header-cell>
              <mat-cell *matCellDef="let element"> {{element.dateAdded}} </mat-cell>
          </ng-container>
          <ng-container matColumnDef="acceptanceStatus">
            <mat-header-cell *matHeaderCellDef mat-sort-header>Zone Acceptance</mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.acceptanceStatus}} </mat-cell>
        </ng-container>
              <ng-container matColumnDef="actions">
                  <mat-header-cell *matHeaderCellDef mat-sort-header> Action </mat-header-cell>
                  <mat-cell *matCellDef="let element">
                      <button mat-button color="accent" data-bs-toggle="modal" data-bs-target="#exampleModal" (click)="setId(element.id)" *ngIf="element.uploadedBy === userName"><mat-icon>delete</mat-icon></button>|
                      <button (click)="setEditId(element.id)" mat-button
                          color="primary"><mat-icon  >edit</mat-icon></button> </mat-cell>
              </ng-container>
              <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
              <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
          </mat-table>
          <mat-paginator *ngIf="dataSourceReviewed" [pageSize]="15" [length]="dataSourceReviewed.data.length"  #paginatorR="matPaginator" [pageSizeOptions]="[15, 50, 100]" aria-label="Select page" showFirstLastButtons>
          </mat-paginator>
      </div>
    </mat-tab>
  </div>
  <div class="sent" *ngIf="sent">
        <mat-tab label="Sent Reports">
          <div class="mat-elevation-z8">
            <mat-card>
              <mat-form-field>
                  <mat-label>Filter</mat-label>
                  <input matInput (keyup)="applyFilterSent($event)" placeholder="Ex. Mia" #input>
              </mat-form-field>
            </mat-card>
            <mat-table [dataSource]="dataSourceSent" matSort>
        
                <ng-container matColumnDef="id">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> ID </mat-header-cell>
                    <mat-cell style="cursor: pointer;" *matCellDef="let element;let i=index" data-bs-toggle="modal" data-bs-target="#detailModal" (click)="viewDetail(element.id)">{{i+1}} </mat-cell>
                </ng-container>
        
                <ng-container matColumnDef="name">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Name </mat-header-cell>
                    <mat-cell *matCellDef="let element" > {{element.name}} </mat-cell>
                </ng-container>
                <ng-container matColumnDef="status">
                  <mat-header-cell *matHeaderCellDef mat-sort-header> Status </mat-header-cell>
                  <mat-cell *matCellDef="let element" > {{element.status}} </mat-cell>
              </ng-container>
                <ng-container matColumnDef="attachment">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Attachment </mat-header-cell>
                    <mat-cell *matCellDef="let element"><a href="assets/reports/{{element.attachment}}" download target="_blank">{{element.attachment}}</a> </mat-cell>
                </ng-container>
                <ng-container matColumnDef="remark">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Description </mat-header-cell>
                    <mat-cell *matCellDef="let element"> {{element.remark}} </mat-cell>
                </ng-container>
                <ng-container matColumnDef="fRemark">
                  <mat-header-cell *matHeaderCellDef mat-sort-header> Remark </mat-header-cell>
                  <mat-cell *matCellDef="let element"> {{element.fRemark }} </mat-cell>
              </ng-container>
              <ng-container matColumnDef="lastModified">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Last Modified </mat-header-cell>
                <mat-cell *matCellDef="let element"> {{element.lastModified }} </mat-cell>
            </ng-container>
              <ng-container matColumnDef="dateAdded">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Date Added</mat-header-cell>
                <mat-cell *matCellDef="let element"> {{element.dateAdded}} </mat-cell>
            </ng-container>
            <ng-container matColumnDef="acceptanceStatus">
              <mat-header-cell *matHeaderCellDef mat-sort-header>Zone Acceptance</mat-header-cell>
              <mat-cell *matCellDef="let element"> {{element.acceptanceStatus}} </mat-cell>
          </ng-container>
                <ng-container matColumnDef="actions">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Action </mat-header-cell>
                    <mat-cell *matCellDef="let element">
                      <button mat-button *ngIf="element.status != 'Sent'" color="accent" data-bs-toggle="modal" data-bs-target="#exampleModal" (click)="setId(element.id)"><mat-icon>delete</mat-icon></button>|
                      <button *ngIf="element.status != 'Sent'" (click)="setEditId(element.id)" mat-button
                          color="primary"><mat-icon  >edit</mat-icon></button> </mat-cell>
                </ng-container>
                <mat-header-row *matHeaderRowDef="displayedColumnSent"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedColumnSent;"></mat-row>
            </mat-table>
            <mat-paginator *ngIf="dataSourceSent" [pageSize]="15" #paginatorS="matPaginator"  [length]="dataSourceSent.data.length" [pageSizeOptions]="[15, 50, 100]" aria-label="Select page" showFirstLastButtons>
            </mat-paginator>
        </div>
        </mat-tab>
      </div>
      </mat-tab-group>
    </section>
    <div class="modal fade mt-5" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
          <div class="modal-content">
                <div class="modal-body">
                <div class="text-center">
                    <i class="fa fa-exclamation-triangle" style="font-size: 40px; color: red;"></i>
                    <h4 class="mt-2">Confirmation!</h4>
                    <p class="mt-3">Are You Sure?</p>
                    <button type="button" class="btn btn-secondary m-2" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" (click)="deleteDept()" data-bs-dismiss="modal" >Continue</button>
                </div>
            </div>
            
          </div>
        </div>
      </div>
    
      <div class="modal fade" id="detailModal">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
      
            <!-- Modal Header -->
            <div class="modal-header">
              <h4 class="modal-title">Report Details</h4>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
      
            <!-- Modal body -->
            <div class="modal-body" *ngIf="reportData">
              <div class="row mt-3">
                <div class="col-md">
                  <strong>Title: </strong> {{reportData.name}}
                </div>
                
                <div class="col-md">
                  <strong>Date Added: </strong>{{reportData.dateAdded}}
                </div>
      
              </div>
              <div class="row mt-3">
                <div class="col-md">
                  <strong>Attachment:</strong> <a href="assets/reports/{{reportData.attachment}}" target="_blank">{{reportData.attachment}}</a>  
                </div>
                <div class="col-md">
                  <strong>Last Modified: </strong>{{reportData.lastModified}}
                </div>
                     
              </div>
              <div class="row mt-3">
                <div class="col-md">
                  <strong>Description: </strong>{{reportData.remark}}
                </div>
                <div class="col-md">
                  <strong>Remark:</strong> {{reportData.fRemark}}
                </div>
              </div>
              <div class="row mt-3">
                <div class="col-md">
                  <strong>Uploaded By: </strong> {{reportData.uploadedBy}}
                </div>
                   
              </div> 
              <div class="row mt-3">
                <div class="col-md">
                  <strong>Current Status : </strong> {{reportData.status}}
                </div>
                   
              </div> 
            </div>
            <div class="col-md">
              <mat-form-field appearance="fill">
                <mat-label>Remark</mat-label>
                <textarea matInput
                cdkTextareaAutosize
                #autosize="cdkTextareaAutosize"
                cdkAutosizeMinRows="2"
                cdkAutosizeMaxRows="10" [formControl]="remark"></textarea>
            </mat-form-field>
            </div>
      
            <!-- Modal footer -->
            <div class="modal-footer">

              <button *ngIf="reportData && reportData.status==='Draft'" type="button" class="btn btn-primary" (click)="updateStatus(reportData.status)">Review</button>
              <button *ngIf="reportData && reportData.status==='Reviewed' &&  role.substring(0,7)==='WOREDA_'" type="button" class="btn btn-warning" (click)="updateStatus('Back')">Back</button>
              <button *ngIf="reportData && reportData.status==='Reviewed'" type="button" class="btn btn-primary" (click)="updateStatus(reportData.status)">Send</button>
              <button *ngIf="reportData && (reportData.status==='Sent' && role.substring(0,5)==='ZONE_' && reportData.acceptanceStatus==='Pending')" type="button" class="btn btn-success" (click)="updateAcceptanceStatus('Accepted')">Accept</button>
              <button *ngIf="reportData && (reportData.status==='Sent' && role.substring(0,5)==='ZONE_' && reportData.acceptanceStatus==='Pending')" type="button" class="btn btn-warning" (click)="updateAcceptanceStatus('Rejected')">Back</button>
              <button *ngIf="reportData && (reportData.status==='Sent' && role==='MAYER' && reportData.acceptanceStatus==='Pending')" type="button" class="btn btn-warning" (click)="updateAcceptanceStatus('Rejected')">Back</button>
              <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="btn-close">Close</button>
                        
            </div>
      
          </div>
        </div>
      </div>